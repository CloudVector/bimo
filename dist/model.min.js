"use strict";var isBrowser="undefined"!=typeof window,isNode="undefined"!=typeof module&&"undefined"!=typeof module.exports,Model=function(e){this._dt=e,this._ev={},this._df={},this._sp=!1,this._ct=0;for(var t in this._dt)this._addProperty(t)};Model.prototype._isObject=function(e){return"[object Object]"===Object.prototype.toString.call(e)},Model.prototype._toObject=function(){return this._dt},Model.prototype._suspend=function(){this._sp=!0,this._ct=0},Model.prototype._resume=function(){var e=this;if(e._sp=!1,e._ct>0){e._ct=0;var t,r,o=[];for(var i in e._dt)if(e._dt.hasOwnProperty(i)&&Array.isArray(e._ev[i]))for(t=0,r=e._ev[i].length;r>t;t++)-1===o.indexOf(e._ev[i][t])&&o.push(e._ev[i][t]);for(t=0,r=o.length;r>t;t++)"function"==typeof o[t]&&o[t].call(e,e._df)}},Model.prototype._delta=function(){return this._df},Model.prototype._reset=function(){this._df={}},Model.prototype._revert=function(e){var t=this,r=function(e){t._df[e]&&(t[e]=t._df[e].original)};if("string"==typeof e)r(e);else if(Array.isArray(e))for(var o=0,i=e.length;i>o;o++)r(e[o]);else if(void 0===e)for(var n in t._dt)t._dt.hasOwnProperty(n)&&r(t._dt[n])},Model.prototype._watch=function(){var e,t,r,o,i,n=this,f={};if(arguments.length>0){if(1===arguments.length?"function"==typeof arguments[0]?t=arguments[0]:n._isObject(arguments[0])&&(e=arguments[0]):arguments.length>=2&&(e=arguments[0],t=arguments[1]),"string"==typeof e&&"function"==typeof t){var _=e.split(" ");for(o=0,i=_.length;i>o;o++)f[_[o]]=t}else if(Array.isArray(e)&&"function"==typeof t)for(o=0,i=e.length;i>o;o++)f[e[o]]=t;else if(n._isObject(e))f=e;else if("function"==typeof t)for(r in n._dt)n._dt.hasOwnProperty(r)&&!n._isObject(n._dt[r])&&(f[r]=t);for(r in f)f.hasOwnProperty(r)&&(n._ev[r]&&-1===n._ev[r].indexOf(t)?n._ev[r].push(f[r]):n._ev[r]=[f[r]])}},Model.prototype._unwatch=function(){var e,t,r,o,i,n=this,f=function(e){if("function"==typeof t&&Array.isArray(n._ev[e])){var r=n._ev[e].indexOf(t);r>-1&&(n._ev[e]=n._ev[e].splice(r,1))}else n._ev[e]=null,delete n._ev[e]};if(arguments.length>0)if(1===arguments.length?"function"==typeof arguments[0]?t=arguments[0]:n._isObject(arguments[0])&&(e=arguments[0]):arguments.length>=2&&(e=arguments[0],t=arguments[1]),"string"==typeof e){var _=e.split(" ");for(o=0,i=_.length;i>o;o++)f(_[o])}else if(Array.isArray(e))for(o=0,i=e.length;i>o;o++)f(e[o]);else if(n._isObject(e))for(r in e)e.hasOwnProperty(r)&&f(r);else for(r in n._dt)n._dt.hasOwnProperty(r)&&!n._isObject(n._dt[r])&&f(r);else n._ev={}},Model.prototype._addProperty=function(e){var t=this,r=function(e,t){var r=!1;if(Array.isArray(e)&&Array.isArray(t)){if(r=e.length===t.length)for(var o=0,i=e.length;i>o;o++)if(-1===t.indexOf(e[o])){r=!1;break}}else r=e===t;return r};t._dt.hasOwnProperty(e)&&!t._isObject(t._dt[e])&&Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:function(){var r=t._dt[e];return"function"==typeof t[e+"Read"]&&(r=t[e+"Read"](r)),r},set:function(o){"function"==typeof t[e+"Write"]&&(o=t[e+"Write"](o));var i=t._dt[e],n={};if(i!==o)if(t._dt[e]=o,t._df[e]=t._df[e]||{original:i},t._df[e].actual=o,t._df[e].previous=i,t._sp)t._ct++;else if(Array.isArray(t._ev[e])){n[e]={};for(var f in t._df[e])t._df[e].hasOwnProperty(f)&&(n[e][f]=t._df[e][f]);r(t._df[e].actual,t._df[e].original)&&delete t._df[e];for(var _=0,d=t._ev[e].length;d>_;_++)"function"==typeof t._ev[e][_]&&t._ev[e][_].call(t._ev[e][_],n)}}})},isBrowser?(window.bimo=window.bimo||{},window.bimo.Model=Model):isNode&&(module.exports={Model:Model});