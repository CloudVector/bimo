"use strict";var Model=function(e){var n="function"==typeof e._toObject?e._toObject():e;Object.defineProperty(this,"_",{enumerable:!1,configurable:!1,writable:!1,value:{dt:n,ev:{},df:{},sp:!1,ct:0}});for(var t in this._.dt)this._addProperty(t)};Model.prototype._isObject=function(e){return"[object Object]"===Object.prototype.toString.call(e)},Model.prototype._clone=function(e){var n,t=this;if(Array.isArray(e)){n=[];for(var o=0,r=e.length;r>o;o++)n.push(e[o])}else if(t._isObject(e)){n={};for(var i in e)e.hasOwnProperty(i)&&(n[i]=e[i])}return n},Model.prototype._toObject=function(){var e=this;return e._clone(e._.dt)},Model.prototype._suspend=function(){var e=this;e._.sp=!0,e._.ct=0},Model.prototype._resume=function(){var e=this;if(e._.sp=!1,e._.ct>0){e._.ct=0;var n,t,o=[];for(var r in e._.dt)if(e._.dt.hasOwnProperty(r)&&Array.isArray(e._.ev[r]))for(n=0,t=e._.ev[r].length;t>n;n++)-1===o.indexOf(e._.ev[r][n])&&o.push(e._.ev[r][n]);for(n=0,t=o.length;t>n;n++)"function"==typeof o[n]&&o[n].call(e,e._.df)}},Model.prototype._delta=function(){var e=this;return e._clone(e._.df)},Model.prototype._reset=function(){this._.df={}},Model.prototype._revert=function(e){var n=this,t=function(e){n._.df[e]&&(n[e]=n._.df[e].original)};if("string"==typeof e)t(e);else if(Array.isArray(e))for(var o=0,r=e.length;r>o;o++)t(e[o]);else if(void 0===e)for(var i in n._.dt)n._.dt.hasOwnProperty(i)&&t(i)},Model.prototype._changed=function(e){var n=this,t=n._delta(),o=!1,r=function(e){var o=!1;return t[e]&&t[e].original!==n[e]&&(o=!0),o};if("string"==typeof e)o=r(e);else if(Array.isArray(e)){for(var i=0,l=e.length;l>i;i++)if(r(e[i])&&o===!1){o=!0;break}}else if(void 0===e)for(var f in t)if(t.hasOwnProperty(f)){o=!0;break}return o},Model.prototype._watch=function(){var e,n,t,o,r,i=this,l={};if(arguments.length>0){if(1===arguments.length?"function"==typeof arguments[0]?n=arguments[0]:i._isObject(arguments[0])&&(e=arguments[0]):arguments.length>=2&&(e=arguments[0],n=arguments[1]),"string"==typeof e&&"function"==typeof n){var f=e.split(" ");for(o=0,r=f.length;r>o;o++)l[f[o]]=n}else if(Array.isArray(e)&&"function"==typeof n)for(o=0,r=e.length;r>o;o++)l[e[o]]=n;else if(i._isObject(e))l=e;else if("function"==typeof n)for(t in i._.dt)i._.dt.hasOwnProperty(t)&&!i._isObject(i._.dt[t])&&(l[t]=n);for(t in l)l.hasOwnProperty(t)&&(i._.ev[t]&&-1===i._.ev[t].indexOf(n)?i._.ev[t].push(l[t]):i._.ev[t]=[l[t]])}},Model.prototype._unwatch=function(){var e,n,t,o,r,i=this,l=function(e){if("function"==typeof n&&Array.isArray(i._.ev[e])){var t=i._.ev[e].indexOf(n);t>-1&&(i._.ev[e]=i._.ev[e].splice(t,1))}else i._.ev[e]=null,delete i._.ev[e]};if(arguments.length>0)if(1===arguments.length?"function"==typeof arguments[0]?n=arguments[0]:i._isObject(arguments[0])&&(e=arguments[0]):arguments.length>=2&&(e=arguments[0],n=arguments[1]),"string"==typeof e){var f=e.split(" ");for(o=0,r=f.length;r>o;o++)l(f[o])}else if(Array.isArray(e))for(o=0,r=e.length;r>o;o++)l(e[o]);else if(i._isObject(e))for(t in e)e.hasOwnProperty(t)&&l(t);else for(t in i._.dt)i._.dt.hasOwnProperty(t)&&!i._isObject(i._.dt[t])&&l(t);else i._.ev={}},Model.prototype._addProperty=function(e){var n=this,t=function(e,n){var t=!1;if(Array.isArray(e)&&Array.isArray(n)){if(t=e.length===n.length)for(var o=0,r=e.length;r>o;o++)if(-1===n.indexOf(e[o])){t=!1;break}}else t=e===n;return t};n._.dt.hasOwnProperty(e)&&!n._isObject(n._.dt[e])&&Object.defineProperty(n,e,{configurable:!1,enumerable:!0,get:function(){var t=n._.dt[e];return"function"==typeof n[e+"Read"]&&(t=n[e+"Read"](t)),t},set:function(o){"function"==typeof n[e+"Write"]&&(o=n[e+"Write"](o));var r=n._.dt[e],i={};if(r!==o)if(n._.dt[e]=o,n._.df[e]=n._.df[e]||{original:r},n._.df[e].actual=o,n._.df[e].previous=r,n._.sp)n._.ct++;else if(Array.isArray(n._.ev[e])){i[e]={};for(var l in n._.df[e])n._.df[e].hasOwnProperty(l)&&(i[e][l]=n._.df[e][l]);t(n._.df[e].actual,n._.df[e].original)&&delete n._.df[e];for(var f=0,a=n._.ev[e].length;a>f;f++)"function"==typeof n._.ev[e][f]&&n._.ev[e][f].call(n._.ev[e][f],i)}}})},"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports={Model:Model}:(window.bimo=window.bimo||{},window.bimo.Model=Model),window.bimo=window.bimo||{},window.bimo.Bind=function(e){var n,t,o,r,i,l,f,a,s,d,c,u=this,p={};e=e||{},"string"==typeof e.config&&(e.config={selector:e.config}),e.config=e.config||{},t=function(e,n,t){e.attachEvent?e.attachEvent("on"+n,t):e.addEventListener(n,t)},o=function(e,n){var t,o,r;if(u.options&&(e.options.length=0,u.placeHolder&&(t=document.createElement("option"),t.value="",t.innerHTML=u.placeHolder,void 0!==n&&null!==n&&""!==n||(t.selected="selected"),t.disabled="disabled",e.appendChild(t)),o="function"==typeof u.options?u.options.call(u):u.options)){if(Array.isArray(o)){for(var i={},l=0,f=o.length;f>l;l++)i[o[l]]=o[l];o=i}for(r in o)o.hasOwnProperty(r)&&(t=document.createElement("option"),t.value=r,t.innerHTML=o[r],r===n&&(t.selected="selected"),e.appendChild(t))}},r=function(e,n,t){e.detachEvent?e.detachEvent("on"+n,t):e.removeEventListener(n,t)},i=function(e,n){var t=function(e){n.call(u,e)};return p[e]=t,t},l=function(e){return void 0===e||null===e},f=function(e){return"[object Object]"===Object.prototype.toString.call(e)},a=function(e){var n;return null!==e&&(n=-1!==["SELECT","INPUT","TEXTAREA"].indexOf(e.nodeName)?e[u.property]:e.innerHTML),"function"==typeof u.write&&(n=u.write.call(u,n,e)),n},s=function(e){if("function"==typeof u.read)u.read.call(u,e);else if(!l(u.elements)&&!l(e))for(var n=0,t=u.elements.length;t>n;n++)-1!==["SELECT","INPUT","TEXTAREA"].indexOf(u.elements[n].nodeName)?u.elements[n][u.property]!==e&&(u.elements[n][u.property]=e):u.elements[n].innerHTML!==e&&(u.elements[n].innerHTML=e)},d=function(e){if(u.twoWay){var n=a(e.target);void 0!==n&&(u.model[u.key]=n)}},c=function(e){for(var n in e)e.hasOwnProperty(n)&&u.key===n&&s(u.model[n])},u.bind=function(e){var n,r,f;if(!l(u.elements)){for(n=0,r=u.elements.length,n=0;r>n;++n)"SELECT"===u.elements[n].nodeName&&o(u.elements[n],u.model[u.key]);s(u.model[u.key])}if(u.model._watch(u.key,c),u.twoWay&&!l(u.elements))for(n=0,r=u.elements.length,n=0;r>n;++n)t(u.elements[n],u.event,d);for(f in u.events)if(u.events.hasOwnProperty(f)&&"function"==typeof u.events[f]){var a=i(f,u.events[f]);for(n=0,r=u.elements.length,n=0;r>n;++n)t(u.elements[n],f,a)}"function"==typeof e&&e.call(u)},u.unbind=function(e){var n,t,o;if(u.model._unwatch(u.key,c),u.twoWay)for(n=0,t=u.elements.length;t>n;++n)r(u.elements[n],u.event,d);for(o in p)if(p.hasOwnProperty(o))for(n=0,t=u.elements.length;t>n;++n)r(u.elements[n],o,p[o]);"function"==typeof e&&e.call(u)},Object.defineProperty(u,"visible",{enumerable:!0,configurable:!0,get:function(){var e=!0;return l(u.elements)||l(u.elements[0])||(e="none"!==u.elements[0].style.display),e},set:function(e){for(var n=0,t=u.elements.length;t>n;n++)u.elements[n].style.display=e?u.display||"":"none"}}),Object.defineProperty(u,"disabled",{enumerable:!0,configurable:!0,get:function(){var e=!1;return l(u.elements)||l(u.elements[0])||(e=u.elements[0].disabled),e},set:function(e){for(var n=0,t=u.elements.length;t>n;n++)u.elements[n].disabled=e}}),Object.defineProperty(u,"readOnly",{enumerable:!0,configurable:!0,get:function(){var e=!1;return l(u.elements)||l(u.elements[0])||-1===["INPUT","TEXTAREA"].indexOf(u.elements[0].nodeName)||(e=u.elements[0].readOnly),e},set:function(e){for(var n=0,t=u.elements.length;t>n;n++)-1!==["INPUT","TEXTAREA"].indexOf(u.elements[n].nodeName)&&(u.elements[n].readOnly=e)}}),Object.defineProperty(u,"required",{enumerable:!0,configurable:!0,get:function(){var e=!1;return l(u.elements)||l(u.elements[0])||(e=u.elements[0].required),e},set:function(e){for(var n=0,t=u.elements.length;t>n;n++)u.elements[n].required=e}});for(n in e)e.hasOwnProperty(n)&&"config"!==n&&(u[n]=e[n]);u.twoWay=void 0===u.twoWay?e.defaults.twoWay:u.twoWay,u.event=u.event||e.defaults.event,u.property=u.property||e.defaults.property,u.elements=e.config.elements||null,u.selector=e.config.selector||null;for(n in e.config)e.config.hasOwnProperty(n)&&(u[n]=e.config[n]);if(u.events=u.events||{},l(u.elements))if(l(u.selector))u.elements=null;else if(u.elements="string"==typeof u.selector?u.container.querySelectorAll(u.selector):u.selector,null===u.elements)throw new Error(['"',u.selector.toString(),'" element not found!'])},window.bimo.Binder=function(e){var n,t=this;n=function(e){var n=e;if(void 0===n||null===n)n=document;else if("string"==typeof e&&(n=document.querySelector(n),null===n))throw new Error(['"',e,'" container selector not found!']);return n},t.container=n(e.container),t.model=e.model||{},t.binds={},t.run=function(e){var n,o=function(n){"function"==typeof n[e]&&n[e].call(n)};for(n in t.binds)if(t.binds.hasOwnProperty(n))if(Array.isArray(t.binds[n]))for(var r=0,i=t.binds[n].length;i>r;r++)o(t.binds[n][r]);else o(t.binds[n])},t.init=function(e,o,r,i){var l;if(e&&(t.container=n(e)),t.model=o,r){i=i||{twoWay:!0,event:"change",property:"value"};for(l in r)if(r.hasOwnProperty(l))if(Array.isArray(r[l])===!0){t.binds[l]=[];for(var f=0,a=r[l].length;a>f;f++){var s=new window.bimo.Bind({container:t.container,model:t.model,key:l,config:r[l][f],defaults:i});t.binds[l].push(s)}}else t.binds[l]=new window.bimo.Bind({container:t.container,model:t.model,key:l,config:r[l],defaults:i})}},t.bind=function(e){t.run("bind"),"function"==typeof e&&e.call(t)},t.unbind=function(e){t.run("unbind"),"function"==typeof e&&e.call(t)},e.model&&e.config&&t.init(t.container,t.model,e.config,e.defaults)};